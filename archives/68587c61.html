<!DOCTYPE html>
<html>
  <!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  
  <title>当我们在下载时，我们在想些什么？ - Skywalker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  
  <meta name="keywords" content=betta-cyber, game, betta, shokill>
  
    <meta name="description" content="betta">
  
  
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.02">
  
  
    <link rel="alternate" href="/atom.xml " title="Skywalker" type="application/atom+xml">
  

  
  <!-- <link rel="stylesheet" href="../css/style.css"> -->
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.4.1"></head>

  <body>
    <div class="container">
      <header class="header">
  <!-- <div class="blog-title">
    <a href="/" class="logo">Skywalker</a>
    <div class="subtitle"></div>
  </div> -->
  <nav class="navbar">
    <ul class="menu">
      
        <li class="menu-item">
          <a href="/" class="menu-item-link " >Home</a>
        </li>
      
        <li class="menu-item">
          <a href="/archives" class="menu-item-link active" >Blog</a>
        </li>
      
        <li class="menu-item">
          <a href="/ebook" class="menu-item-link " >Ebook</a>
        </li>
      
        <li class="menu-item">
          <a href="/music" class="menu-item-link " >Music</a>
        </li>
      
        <li class="menu-item">
          <a href="/about" class="menu-item-link " >About</a>
        </li>
      
    </ul>
  </nav>
</header>

<article class="post">
  <div class="post-title">
    <h1 class="article-title">当我们在下载时，我们在想些什么？</h1>
  </div>
  <div class="post-content">
    <h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>曾经有一种从 IE 缓存目录提取缓存数据然后重命名就可以下载各种在线音频和视频的方法。</p>
<p>🖥这种方法侧面证明了浏览互联网内容即是一个不断下载文件的过程。</p>
<p>😋我们每时每刻都在download。</p>
<p>所以，当我们在下载的时候，我们在想些什么🧐？</p>
<h2 id="从下载的几种方式开始"><a href="#从下载的几种方式开始" class="headerlink" title="从下载的几种方式开始"></a>从下载的几种方式开始</h2><h3 id="最基础的下载方式-——-HTTP-S"><a href="#最基础的下载方式-——-HTTP-S" class="headerlink" title="最基础的下载方式 —— HTTP(S)"></a>最基础的下载方式 —— HTTP(S)</h3><p><a target="_blank" rel="noopener" href="https://downloads.mongodb.com/compass/mongodb-compass_1.32.1_amd64.deb">https://downloads.mongodb.com/compass/mongodb-compass_1.32.1_amd64.deb</a> 这个链接看起来很熟悉是吗？当下载提示弹出来的一刻，你有没有认识到这种最直接最为人熟知也是最多人使用的下载方式，和访问网页这一行为之间的区别？</p>
<p>答案是没有区别。</p>
<p>HTTP 制定了双方该怎么说，用什么方式让对方听到，碰到各种情况如何回应。浏览器和服务器都遵守这个规矩，可以避免出现「鸡同鸭讲」的问题。</p>
<p>我们之所以会常识性地把浏览网页和下载文件区分开，是因为浏览器里面内置了可以将这些数据视觉化的解释引擎「简单理解：解码器」，当首页数据文件下载完毕时立即渲染出可以直接「看」的网页；而一些它「读不懂」的数据，则会提示你保存到设备让其他可以「读懂」的程序打开它。</p>
<p>优点:</p>
<ul>
<li>不需要专用的下载工具。使用普通浏览器甚至不需要浏览器都可以随时随地保存文件。</li>
<li>文件名，格式和下载域名直接可见，可以一定程度避免下载到错误的文件。</li>
<li>轻松达到满速。在服务器带宽足够或有好的 CDN 情况下下载速度可以轻松达到物理宽带满速。</li>
</ul>
<h3 id="断点续传与多线程下载加速的原理"><a href="#断点续传与多线程下载加速的原理" class="headerlink" title="断点续传与多线程下载加速的原理"></a>断点续传与多线程下载加速的原理</h3><p>说到 HTTP 下载，那不得不提到一些现在或者曾经非常好用的 HTTP 下载器，比如 Windows 上老牌的 IDM，活在人们心中的网络蚂蚁和网际快车，被誉为手机版 IDM 的 ADM 等。它们之所以受到人们的喜爱与称赞，是因为它们提供了曾经是杀手锏级别的两个功能 —— 断点续传与多线程下载，这两个功能节省了大家巨量的下载时间，但是你知道这两个功能是怎样工作的吗？</p>
<h4 id="断点续传的原理"><a href="#断点续传的原理" class="headerlink" title="断点续传的原理"></a>断点续传的原理</h4><p>断点续传的原理其实非常简单。我们平时下载的文件，无论是 MP3，FLV 还是其他随便什么格式，服务器都是采用流（Stream）的方式传到我们的本地设备上。就像往杯里倒水一样，不管是橙汁还是牛奶都是一样地从瓶里流到杯里，带宽即相当于瓶口的宽度，决定你能倒多快。</p>
<p>以一个 1MB 的文件为例，当你下载了 512KB 然后按下暂停下载按钮的时候，什么也不会发生。只有在你下次继续下载的时候，支持断点续传的客户端才会以字节数的方式直接在请求头告诉服务器我需要从第 512000 字节开始下载，支持断点下载的服务器就会从 512000 字节开始传输流并返回一个表示「这是续传」的状态码 206 以说明这个不是重新下载的流。</p>
<p>到这里断点续传还要解决一个问题，就是当暂停下载文件之后，服务器上的文件被修改了，如果接着下载的话最后文件数据肯定是错的。支持断点续传的客户端在请求续传时，除了告诉服务器已经下载的大小，还会告诉服务器这个文件在上次暂停时最后修改的时间或者整个文件的文件指纹。</p>
<p>服务器比较之后决定是续传还是从头开始传输文件流给客户端，为了避免服务器端重新传输文件流而客户端认为是续传的文件流，从头开始下载的时候服务器会返回 200 状态码。</p>
<p>用 200、206 两个状态码即可保证客户端和服务器不会误解对方。</p>
<h4 id="多线程下载加速的原理"><a href="#多线程下载加速的原理" class="headerlink" title="多线程下载加速的原理"></a>多线程下载加速的原理</h4><p>多线程下载其实是利用断点续传的一个机智技巧。</p>
<p>一般的服务器是通过同时下载的线程数平均分配下载带宽，假设一个服务器上的某个文件最高享有 100M 的带宽，同时有 50 个线程下载的时候每个线程分到的下载速度即是 2m&#x2F;s。可是单纯的服务器认为一个人只能用一个线程来下载，怎想到其中 10 个线程都是同一个人用多线程下载器请求的，那这个人分到了多少下载速度？20M&#x2F;s！知道多线程下载为什么能够提升下载速度了吧，那么多线程实际上是怎样「欺骗」服务器的呢？答案是利用断点续传，简单来讲，一个 10 线程的下载器在接到下载一个文件的请求之后：</p>
<ul>
<li>首先做的就是向服务器请求这个文件的大小然后切成 10 份。</li>
<li>接着每一个线程假装断点续传，分别在请求下载的请求头中告诉服务器我要从 1&#x2F;10，2&#x2F;10，3&#x2F;10…9&#x2F;10 开始下载，服务器天真地以为这真的是一个断点续传的请求于是便从这个线程要求的地方开始传输文件流。</li>
<li>只需要 1&#x2F;10 时间，文件已经下载完毕，下载器再在本地把这十块文件拼起来。</li>
</ul>
<p>多线程可以加快下载速度的原因是 TCP 设计之初非常为他人着想，能用少带宽办到的事情绝对不会申请更多的带宽，尽量留给其他人更多的带宽。</p>
<p>简单来说就是在 TCP 开始传输数据时，服务端会不断的探测可用带宽。在一个传输内容段被成功接收后，会加倍传输两倍段内容，如果再次被成功接收，就继续加倍，直到发生了丢包，这是这也被叫做慢启动。当达到慢启动阀值（ssthresh）时，满启动算法就会转换为线性增长的阶段，每次只增加一个分段，放缓增加速度。我觉得其实慢启动的加倍增速过程并不慢，只是一种叫法。</p>
<p>但是当发生了丢包，也就是检测到拥塞时，发送方就会将发送段大小降低一个乘数，比如二分之一，慢启动阈值降为超时前拥塞窗口的一半大小、拥塞窗口会降为1个MSS，并且重新回到慢启动阶段。这时多线程的优势就体现出来了，因为你的多线程会让这个速度减速没有那么猛烈，毕竟这时可能有另一个线程正处在慢启动的在最终加速阶段，这样总体的下载速度就优于单线程了。</p>
<p>根本的问题是 TCP拥塞控制的不精确。这个问题源于TCP的初始窗口设定、窗口增长策略、带宽探测策略，TCP单流很难利用满带宽。初始窗口较小或者减窗过猛都会拉低带宽利用率。后面 Google 设计于2016年发布的拥塞算法 TCP BBR 稍微解决了这个问题。</p>
<h3 id="专为传输文件的下载方式-——-FTP"><a href="#专为传输文件的下载方式-——-FTP" class="headerlink" title="专为传输文件的下载方式 —— FTP"></a>专为传输文件的下载方式 —— FTP</h3><p>ftp:&#x2F;&#x2F; 开头的链接相信大家都见过，也下载过，感觉上和 HTTP 下载没有什么两样。那么你知道它和 HTTP 的区别吗？</p>
<p>要说他俩，那就要详细说一下前面提到的它俩的母亲 —— TCP 协议。</p>
<p>TCP 协议和我们熟悉的 IP 一起组成的 TCP&#x2F;IP 协议族是互联网的基础，TCP 定义了数据如何传输，IP 定义了如何联系互联网上的设备。HTTP，FTP 和其他协议都是从它们身上延伸出来的，可以说 HTTP 和 FTP 是亲兄弟。不过大哥可不是 HTTP。事实上 FTP（1971） 比 HTTP（1989） 的诞生早了 18 年左右，甚至比现在定义的互联网出现的还要早！</p>
<p>大家知道互联网并不是世界上最早的网络吗？互联网的祖先 ARPAnet（Advanced Research Projects Agency Network）才是真正的始祖。这个网络采用的通信协议是 NCP（Network Control Program，网络控制程式），那个时候 TCP&#x2F;IP 和 HTTP 还没影，基于 NCP 的 FTP 就已经出现了，作为阿帕网中计算机之间传输文件的协议。后来阿帕网逐渐变成互联网，NCP 也变成了 TCP&#x2F;IP，FTP 才把底层协议换成 TCP。所以说，FTP 才是当之无愧的大哥。</p>
<p>虽然 HTTP 和 FTP 都是同一个协议拓展出来的，不过 HTTP 多是针对为客户端提供文件传输；FTP 则是为了在特定主机之间相互传输文件而开发的标准，互联网出现之前还没有浏览器这种客户端。<br>由于涉及到双向传输数据，因此在连接 FTP 服务器的时候我们必须通过用户名和密码认证自己的身份。<br>那为什么我们通过 FTP 下载的时候不用输入用户名和密码呢？因为密码是可选的，只要服务器以 Anonymous 作为用户名，那么它储存的文件任何人都可以访问。</p>
<p>除了结构上有所不同以外，在下载时 HTTP 和 FTP 的方便性和下载时间是一模一样的，这意味着它们的优缺点也差不多。FTP 主要是一些需要在服务器上同时储存和交换大量文件的站点在使用，像是大名鼎鼎的电影天堂就以 FTP 作为下载他们电影的唯一方式：</p>
<p><a href="ftp://ygdy8:ygdy8@yg48.dydytt.net:2679/[%E9%98%B3%E5%85%89%E7%94%B5%E5%BD%B1-www.ygdy8.com]%E9%94%B5%E9%94%B5%E4%B8%89%E4%BA%BA%E8%A1%8C20160401.rmvb">ftp://ygdy8:ygdy8@yg48.dydytt.net:2679/[阳光电影-www.ygdy8.com]锵锵三人行20160401.rmvb</a></p>
<p>附上 FTP 链接的结构解释：<br>ftp:&#x2F;&#x2F;[用户名:口令@]ftp服务器域名或IP:[端口号]&#x2F;文件路径&#x2F;文件名。</p>
<p>另外，在很多部电影，特别是特工电影中都出现过 FTP 的身影，比如 Netflix 2017 年的电影《王牌保镖》第 98 分钟就出现了登录 FTP 输入密码的全过程。感兴趣的朋友可以看下这部电影。<br>匿名 FTP 的特性还受到各个字幕组和游戏破解组的青睐，像是大名鼎鼎的游戏破解组 CPY 就是通过 FTP 发布新的破解游戏。</p>
<h3 id="进阶，从半中心化到完全去中心化"><a href="#进阶，从半中心化到完全去中心化" class="headerlink" title="进阶，从半中心化到完全去中心化"></a>进阶，从半中心化到完全去中心化</h3><h4 id="什么是下载中心化？什么是下载去中心化"><a href="#什么是下载中心化？什么是下载去中心化" class="headerlink" title="什么是下载中心化？什么是下载去中心化?"></a>什么是下载中心化？什么是下载去中心化?</h4><p>顾名思义，中心化的核心是中心 - 在下载中指的是储存着文件数据的一个或者确定数量的服务器，中心化意味着只有特定的储存着文件数据的服务器没有关闭并且开放数据，用户才能获取到它所储存的文件数据，一旦服务器遭遇不可抗力挂掉或者它的的所有者关闭对外开放的下载端口，我们就没办法再下载上面的东西。<br>中心化在文件下载时的缺陷再明显不过，加上基础下载方式的种种缺点，早期顶着拨号上网龟速的网民们在下载大文件的时候往往是提心吊胆的，生怕突然就弹出一个下载失败的框框。最可怕的是，有时候下载失败的文件需要重新下载而不是继续下载。<br>对等式网络（peer-to-peer，简称 P2P），核心就是去中心化，所有的信息交互都由每一个用户「peer」之间完成，在整个对等式网络中的每一个用户即是一个节点，每一个节点都不能单独定位其他节点，必须通过整个节点网络（所有用户）才能定位目标节点。对等式网络也是现在和未来文件下载和数据交互的趋势。</p>
<h4 id="eD2k-下载"><a href="#eD2k-下载" class="headerlink" title="eD2k 下载"></a>eD2k 下载</h4><p>说到 eD2k（eDonkey2000 Network） 国人最熟悉的莫过于电驴（VeryCD）了吧，不过与大家想象中的巨量文件不同，电驴整个站只储存了文件的 eD2k 链接（整个电驴储存的文件链接填入 TXT 可能就几十MB） ，那么它是如何 24*7 不间断提供巨量资源下载的呢？这要从 eD2k 网络的原理讲起。<br>严格来讲 eD2k 并不是文件下载协议而是文件共享协议，用户在使用 eD2k 客户端的时候必须在本地设置一个共享目录和公网端口，所有放在共享目录里的文件都可以被其他 eD2k 用户检测并读取。<br>只要用户数量足够多，并且每一个用户都自觉将文件放到共享目录里面分享出去，作为一个小小的下载源。这样子所有用户就能组成一个全面又实时保持更新迭代的超巨型下载服务器。像是电驴这种服务器只是提供获取文件的方法，也就是文件链接，所有文件都是由独立的用户分享的。<br>eD2k 还支持通过文件指纹将不同文件名的同一文件成功识别为一个文件，并把大文件「&gt;&#x3D; 9.28 MB」切成一个个小小的文件块，当同一个文件有多个人共享的时候就会同时从每一处提取不同的文件块，达到加速下载的效果。<br>ed2k:&#x2F;&#x2F;|file|eMule0.5c.zip|2868871|0F88EEFA9D8AD3F43DABAC9982D2450C|&#x2F;</p>
<p>它的结构简单清晰：<br>ed2k:&#x2F;&#x2F;|file|&lt;文件名&gt;|&lt;文件大小&gt;|&lt;文件指纹&gt;|&#x2F;</p>
<p>每一个共享目录里面的文件都会生成一个像这样子的链接，当别人在客户端打开这条链接或者在文件站点（如电驴）里面搜索 eMule0.5c.zip 这个文件名时，所有文件指纹为 0F88EEFA9D8AD3F43DABAC9982D2450C 的共享文件都会提供下载数据，从而实现去中心化的下载。<br>实际上最早的 eD2k 网络也是需要中心服务器来实现用户间的通讯，eD2k 在这个阶段只能说是半中心化，同时 eD2k 还深受钓鱼服务器的困扰，直到后来新的 eMule（中文：电骡）客户端支持 KAD 网络之后才实现完全去中心化。</p>
<p>很多人可能就有问题了，为什么我在用迅雷&#x2F;旋风下载 eD2k 文件的时候不用设置共享目录呢？这就涉及到一个名为「吸血驴」的违反互联网精神的行为。简单来讲，就是「又想马儿跑，又想马儿不吃草」，这些客户端利用 eD2k 的优点吸引用户，又不能因为 eD2k 麻烦的配置和对上传速度的要求吓跑用户，所以很狡猾地利用各种伪装方法从 eD2k 网络下载文件但是一丁点儿数据都不会共享给 eD2k 网络。<br>这种方法显然是非常不道德的。试想一下当用「吸血驴」客户端的人越来越多，那么实际提供文件的用户会越来越少，也就是说能下的东西越来越少，能下的东西越少就越少人用，构成一个恶性循环。事实上吸血驴也是 eD2k 没落的重要原因。</p>
<p>再来就是国情的问题，eD2k 共享目录里面的文件需要不断地上传，这显然不适合国内上下传不对等的小水管宽带。而且某些地区的运营商还会直接砍掉 KAD 网络的支持，让 eD2k 下载变得更加艰难。</p>
<h4 id="BT-下载"><a href="#BT-下载" class="headerlink" title="BT 下载"></a>BT 下载</h4><p>BT，种子，磁力链接，magnet:?xt&#x3D;，相信每一个经常下载文件的人看到这些名词都会眼前一亮。没错，这些词都属于我们在使用 BT（BitTorrent，种子）下载时频繁碰到的名词。那么这些名词又到底代表了什么？</p>
<h4 id="从种子文件理解-BitTorrent-协议"><a href="#从种子文件理解-BitTorrent-协议" class="headerlink" title="从种子文件理解 BitTorrent 协议"></a>从种子文件理解 BitTorrent 协议</h4><p>说到 BT 就不得不说扩展名为 .torrent 的种子文件，因为必须有种子文件才可以下载到对应的 BT 资源。那平时老听到有人说留种的时候，到底留的是什么呢？<br>留的是 Tracker 信息和文件信息。<br>我们以一部电影的种子 [betta][Batman][2160P][HEVC_Ma10P][MKV].torrent 为例。<br>当用记事本或者其他文本浏览器打开这个种子文件，看到的是一大串类似于链接的字符串，后面跟着的是谁都看不懂的乱码。<br>Tracker 信息</p>
<p>红框即为这个种子自带的下载中需要用到的 Tracker 服务器的地址和针对 Tracker 服务器的设置，Tracker 服务器的作用就是提供给下载者已经下载或者正在下载资源的其他下载者的地址信息，方便下载者与其他下载者连接。<br>种子内置了 Tracker 的好处就在于如果大家都是用这个种子下载的资源，后来下载的人可以直接通过这几个 Tracker 和正在下载或拥有这个文件的人连接。<br>文件信息<br>在 Track 服务器之后我们还能看到一段不是乱码的字符，这里和后面的乱码一起组成了需要下载的文件信息。</p>
<p>先简单说一下常见的文件基础信息，信息以冒号分割：</p>
<ul>
<li>creation date: 种子创建日期，是从1970年1月1日00:00:00到现在的秒数。</li>
<li>encoding: 种子文本编码，一般都是 UTF-8。</li>
<li>name: 显而易见是我们要下载的文件名。</li>
<li>Pieces: 文件被分成了多少块（可以看到这里分为了 77680 块）。</li>
<li>piece length: 每块文件的大小。</li>
<li>files 与 path: 如果种子文件中有多个文件或文件夹，这两个关键字就是用来展示它们的。<br>小知识：种子文件里面也可以包含 eD2k 信息。<br>剩下的乱码即是 BT 生成的每一块切好的文件块的指纹，在下载电影的时候每下载一块下载器会对比种子里的指纹和下载数据是不是匹配的，这样子可以确保下载时数据的准确性。即使是出错，需要重下的也只是出错的那小小的一部分。</li>
</ul>
<h4 id="BT-的「救星」——-磁力链接"><a href="#BT-的「救星」——-磁力链接" class="headerlink" title="BT 的「救星」—— 磁力链接"></a>BT 的「救星」—— 磁力链接</h4><p>Tracker 服务器在 BT 下载的过程中起着不可或缺的作用，没了它我们就找不到和我们一起下载的小伙伴，相当于 BT 下载的「中心」，这个时候的 BT 下载和早期 eD2K 一样只能说是「半中心化」。由于 BT 下载经常被人用来传播无版权和情色限制级资源，Tracker服务器很容易被迫关闭或被墙。<br>全球最大的 BT 种子服务器海盗湾，它同时也是一个巨型 Tracker，无数合法或不合法的资源都能够在海盗湾找到。正所谓树大招风，它被所在国瑞典的警察反复查水表，靠着转移服务器和将种子转换为磁力链接坚强地活了下来。而国外大部分 Tracker 就没那么好运了，关闭的关闭停止解析的停止解析。<br><a target="_blank" rel="noopener" href="https://github.com/XIU2/TrackersListCollection/blob/master/README-ZH.md">https://github.com/XIU2/TrackersListCollection/blob/master/README-ZH.md</a><br>Tracker 服务器自带的另一个严重缺点是所有文件分享者都会被它追踪，特别是在中国。<br>一些聪明人就通过基于 KAD（Kademlia）网络的DHT（分布式哈希表）网络技术实现了这个例子，磁力链接就是基于 DHT 诞生的。<br>磁力链接（Magnet URI scheme）的出现让 Tracker 不再是 BT 下载中的必需品，甚至不再需要 Tracker。很好地解决了之前 BT 下载的缺陷。<br>magnet:?xt&#x3D;urn:sha1:YNCNHJKIWBTRNJIV4YUAE52SJUQFGY4A</p>
<p>magnet:? 开头，我们经常还可以在连接前面看到一个小磁铁的图标，其中 xt 为必须项，后面跟着是根据文件或文件夹内容生成的身份 - 数字指纹。其他常见选填项还有：</p>
<ul>
<li>dn：文件名</li>
<li>xl：文件大小</li>
<li>xs：P2P链接</li>
<li>Kt：用于搜索的关键字</li>
<li>Mt：文件列表</li>
<li>Tr：BT下载的 Tracker 地址</li>
</ul>
<p>DHT 的原理可以用一句话来概括：把所有的用户都变成 Tracker。和传统的 Tracker 一样，每一个支持磁力链接的下载客户端都会在本地以一个名为 DHT.dat 的文件动态地储存和更新一小段下载者和下载文件的信息，可以简单理解为如果正在联网的下载客户端足够多，那么 Tracker 信息合并起来就相当于一个巨大的 Tracker 服务器。</p>
<p>轻巧，相对安全和去中心化的优点让越来越多的网站删除种子开始全面使用磁力链接，越来越多的破解软件和游戏破解组，还有各种不想公开身份的汉化组也都开始从 Topsite（一种私人限制进入的 FTP 服务器）转为磁力链接分享资源，在今后这一趋势还会持续增长。</p>
<h3 id="有潜力的下载方式：Metalink，UDP-与-PT。"><a href="#有潜力的下载方式：Metalink，UDP-与-PT。" class="headerlink" title="有潜力的下载方式：Metalink，UDP 与 PT。"></a>有潜力的下载方式：Metalink，UDP 与 PT。</h3><h4 id="Metalink"><a href="#Metalink" class="headerlink" title="Metalink"></a>Metalink</h4><p>我们先从最简单的 Metalink 开始，与 BT 和 eD2K 等下载协议不同，Metalink 是一个非常简单易懂的下载标准。简单描述就是 Metalink 文件储存了可以下载一个或多个文件的多种下载方式的多个地址，相当于让你可以同时用不同的下载方式下载同一个或多个文件。<br>以 openSUSE 的发行版 openSUSE-Leap-15.4-DVD-aarch64-Build243.2-Media.iso.meta4 为例<br>暂时无法在文档外展示此内容<br>直白到你新建一个文本文件，按照上面格式照猫画虎地填入自己文件的数据, 就能创建这个文件的 Metalink（甚至都不用改文件格式名，txt 都行）。它并没有新酒，而是将不同的旧酒都装在一个新瓶子里，那这样子做的优点有啥呢？</p>
<p>Metalink 的优点：</p>
<ul>
<li>在用支持 Metalink 的下载客户端下载的时候，如果一个链接失效了，下载器会自动继续使用另一个链接继续下载。一个包含几十条 http、ftp、eD2K、种子地址和磁力链接的 Metalink 几乎不存在下载失败的可能</li>
<li>可以同时用不同的下载方式「混搭」下载文件的不同文件块（类似 BT 的文件分块），通过 Metalink 里面提供的多种文件校验方式实时校验文件，一旦发现下载错误的文件块会立即重新下载这部分文件块。</li>
<li>可以定义各种下载方式的优先级。</li>
<li>支持把下载信息包含在 HTTP 请求中，让用户不知道自己用的是 Metalink 方式下载。</li>
</ul>
<h4 id="UDP-协议"><a href="#UDP-协议" class="headerlink" title="UDP 协议"></a>UDP 协议</h4><p>首先当然是下载方面啦，就以迅雷为例子，我们可以在迅雷的设置中看到 UDP 端口设置）。在非 P2P 下载（例如离线下载或者边下边看）的时候迅雷会用 UDP 传输数据，以保证我们能用最快的速度下载或者看到视频，还能节约服务器资源。</p>
<h5 id="流媒体"><a href="#流媒体" class="headerlink" title="流媒体"></a>流媒体</h5><p>我们平时视频聊天或者看直播的时候都会遇到过卡顿或者色块等等现象，这就是因为它们都是即时性比较高但是对数据完整性不那么苛刻的场景，所以全部是用 UDP 的方式传输数据的，这些卡顿和色块就是因为 UDP 丢包了。其中基于 UDP 的协议 Google 家的 WebRTC 已经成了流媒体传输的通用标准，是视频直播网站们的标配。</p>
<h5 id="实时游戏"><a href="#实时游戏" class="headerlink" title="实时游戏"></a>实时游戏</h5><p>TCP 协议一旦发生丢包，它会将后续包缓存起来，等前面的包重传并接收到后再继续发送，丢的包越多延迟会越来越大。这对于一些必须实时性的场景比如对战游戏来讲简直就是灾难。<br>所以无论是电脑上的Dota，LOL；索尼，微软，任天堂主机上面所有游戏的网络服务；再到手机上的王者荣耀，阴阳师，荒野行动等都采用 UDP 作为数据传输的方式。加上自定义的重传策略，能够把丢包产生的延迟降到最低，尽量减少网络波动对游戏性造成的影响，这才让实时对战游戏成为可能。现在知道为什么游戏的延时会让人物各种闪现鬼畜了吧（比如王者荣耀的 460ms），因为 UDP 会跳过丢失的数据包直接处理后面接收到的数据。</p>
<h5 id="物联网"><a href="#物联网" class="headerlink" title="物联网"></a>物联网</h5><p>物联网也在设备之间的网络交流中用到了 UDP 协议，用以将网络控制的延时降低到与有线和红外遥控相差无几，而且还能降低设备的性能要求从而降低功耗。随着类似的场景越来越多，UDP 将会继续发光发热，直到有更好的协议将它代替。</p>
<h5 id="PT-下载"><a href="#PT-下载" class="headerlink" title="PT 下载"></a>PT 下载</h5><p>之所以把 PT（Private Tracker）下载放到最后来讲，是因为它是下大文件最稳定也是门槛最高的下载方法。从英文名即可看出 PT 是将 BT 下载中开放的 Tracker 变为封闭私有的 Tracker，同时关闭 DHT 减少用户人数来达到建立资源爱好者们的「小圈子」的目的。<br>PT 的优势在于「保种」，普通的种子一旦过了热度最高的时候，下载人数会骤然降低，导致种子无法下载或者下载速度过慢。而 PT 论坛通过互利互惠的方式让论坛用户主动保持种子的热度，从而达到下载稀有资源和满速下载的目的。一般来讲国内 PT 论坛分享的主要是蓝光原盘和超高清视频。</p>
<p>PT 下载即是私密的 BT 下载，主体一般为 PT 论坛。为了保证论坛资源的质量和下载速度，PT 论坛一般都不会开放注册，需要邀请人担保或者看管理员心情。一旦有幸进入一个 PT 站，那么对用户来讲最重要的应该就是 passkey 了。<br>Passkey 是一串字符，代表着用户在论坛里面的「代号」，PT 站会规定用户上传一定大小的数据才能下载一定大小的数据。也就是说新人必须先在论坛下载一些完整的资源，并且给其他用户提供一定量的数据之后 PT 站才会给他开放下载流量。现在许多 PT 论坛还有新人考核，必须在一定时间内完成要求（例如：30天内上传 20G，下载10G）才能成为论坛成员。<br>用户在 PT 站下载的所有种子都会带有专属的 passkey，PT 站会通过 passkey 确定用户的上传量，并按照一个特定的比率分配下载量。当然也只有通过论坛下载的带 passkey 的种子下载资源才能享受到满速下载的福利。<br>除了下载别人的资源，用户也可以上传自己资源来提高上传量，只需要将本地的私有种子上传到论坛生成一个带有 passkey 的种子，然后把种子下载回来本地做种就行了。一般 PT 论坛对上传资源的质量和内容有着严格的要求，这也是 PT 下载的优势之一。<br>对于违反论坛规定和没有贡献的用户 PT 论坛惩罚起来是毫不手软的，卖邀请卖号的立即删号，一段时间上传下载比率太低的立即删号，passkey 被泄露的立即删号（无法从技术手段根绝 passkey 泄露，所以 PT 论坛不允许使用迅雷等「吸血」客户端下载带 passkey 的种子，只能用 μtorrent 等客户端），严格的 PT 论坛连一个人用多个账号或者多个人用一个账号都会被删号。<br>最后推荐一个浏览器插件 PT助手</p>
<h3 id="下载神器-Aria2"><a href="#下载神器-Aria2" class="headerlink" title="下载神器 Aria2"></a>下载神器 Aria2</h3><p>你还在忍受龟速下载吗？<br>迅雷极速版不能加速？逼着用户升级迅雷9浏览器。但是 UI 实在是无法接受，也是满屏幕广告，只能另觅其他的下载工具。Free Download Manager、uTorrent、qBittorrent、BitComet等等全部折腾了一遍，包括多年前的脱兔都用上了……从速度、稳定性、资源占用各方面比较下来，似乎都不太满意？</p>
<p>Aria2 是一个开源的命令行下轻量级（4-9MB占用）、多协议（支持 HTTP&#x2F;HTTPS、FTP、BitTorrent 也就是 BT 下载、磁力链接、Metalink）、多来源（从多个源地址下载同一个文件）的下载工具，它的特点是可以轻松装在主流系统，路由器和 NAS 甚至旧手机上实现多线程同步下载多个文件，并且内存和 CPU 占用极少。<br>虽然它十分好用，以至于有许多用户直呼「替代迅雷」，不过 Aria2本身是通过命令行进行添加下载和暂停等操作的，操作起来门槛高又繁琐。Aria2 支持图形化界面通过接口控制，让它不至于变成极客们专属的玩具。随着用户的增多，各种傻瓜懒人一键安装包和好用的管理 App 也相继出现，只要花点时间就能轻松装上它。</p>
<h4 id="Aria2-的优点"><a href="#Aria2-的优点" class="headerlink" title="Aria2 的优点"></a>Aria2 的优点</h4><ul>
<li>Aria2 最大的优点，也是人们愿意不辞繁琐去用它的最大原因是隐私和文件安全保证。开源的 Aria2 确保不会将你下载的文件，机器上的其他文件或者个人信息上传到各种奇奇怪怪的公司和组织。不会像某些下载器一样拦截篡改下载文件，把某些文件变成「敏感资源」，只要你的地址正确有效，下载回来的一定是正确完整的文件。也不会有各种会员和超贵的正版费用，还三天两头要你更新。</li>
<li>支持全自动多线程下载和断点续传。这个是所有高级下载器都必须有的功能。</li>
<li>超级轻量化。官方测试的结果是普通下载占用 4MB 内存，BT 下载占用 9MB 内存，20M 宽带满速下载占用6% 的 CPU。 不说电脑，只要不是远古级别的手机，甚至普通的路由器都能轻松 Hold 住 Aria2。下载时不仅不会影响机器性能，挂机下载时还可以节约不少电。</li>
<li>BT 下载和 Metalink 支持。这是 macOS 和一众 Linux 系统的福音，从此种子和磁力链接可以通过自己的 VPS 或者 NAS 离线下载。</li>
<li>支持 RPC 远程控制。通俗的讲，Aria2 是一个「核」，它支持人们通过各自制作各种各样的「壳」来操作它。这个壳可以是一个 App，一个网站甚至一个本地网页，这些「壳」不仅没有其他下载器的各种花式广告，界面也相当的漂亮。有能力的朋友也可以自己动手写一个「壳」或者直接通过命令行操作 Aria2 实现高级自定义下载。</li>
</ul>
<p>webui-aria2</p>
<p>AriaNg : 我在 Linux 上用的这个的 GUI 客户端。</p>
<p>搭配百度云<br>神器 <a target="_blank" rel="noopener" href="https://www.tampermonkey.net/">https://www.tampermonkey.net/</a></p>
<p>Tampermonkey 是一款免费的浏览器扩展和最为流行的用户脚本管理器，它适用于 Chrome, Microsoft Edge, Safari, Opera Next, 和 Firefox。 虽然有些受支持的浏览器拥有原生的用户脚本支持，但 Tampermonkey 将在您的用户脚本管理方面提供更多的便利。 它提供了诸如便捷脚本安装、自动更新检查、标签中的脚本运行状况速览、内置的编辑器等众多功能， 同时Tampermonkey还有可能正常运行原本并不兼容的脚本。<br>在greasyfork上搜索一下脚本，就可以看到一堆</p>
<p>一般的资源就会有这种获取直链的，接着推送到 Aria2 就好了。</p>
<p>尽情享受下载吧。</p>
<h2 id="下载过程中的安全与隐私"><a href="#下载过程中的安全与隐私" class="headerlink" title="下载过程中的安全与隐私"></a>下载过程中的安全与隐私</h2><h3 id="文件安全——篡改很容易，改完难发现"><a href="#文件安全——篡改很容易，改完难发现" class="headerlink" title="文件安全——篡改很容易，改完难发现"></a>文件安全——篡改很容易，改完难发现</h3><p>首先我们需要了解到一个很关键的事实：HTTP 协议是明文传输数据的。像之前提到的那样，浏览器中打开的控制台中你可以看到所有 http 请求的内容，包括请求头，请求内容，回应头，回应内容和请求的文件等。<br>我们在自己设备上看到这些没有多大问题，因为这些内容本来就是要给我们的。但是，一旦别有用心的人在服务器发送到客户端之前拦截到这些数据，那么他想要解读或者修改这些明文的数据将「易如反掌」。并且由于 HTTP 只通过状态码来确认请求状态，我们根本无法确定收到的数据是否已经被篡改。<br>安全领域中大名鼎鼎的中间人攻击，就是我们通过 http 方式下载文件的时候最有机会碰到的一种攻击方式。</p>
<p>为了更好地理解文件下载中的中间人攻击，我们来举一个例子：<br>Alice 连接到了 Web 服务器上，Bob打算了解 Alice 正在发送什么信息。于是 Bob 建立 MITM 攻击，通过告诉服务器他是 Alice，并且告诉 Alice 他是服务器。现在，所有 Alice 的请求都会发给 Bob，Bob 会将它们转发给服务器，并对服务器的响应做相同操作。这样，Bob 就能够拦截、读取或修改所有 Alice 和服务器之间的流量。<br>在下载中，攻击者只需要让将我们需要下载的文件替换成他们准备好的文件即可。中间人攻击的难点在于如何加入到通信过程中，一般是这几个情况：</p>
<ol>
<li>连接到 Wi-Fi 等局域网中的其他设备。这里分两种情况，一种是攻击者可以访问网关，比如「黑客」们经常在公共场合建立钓鱼 Wi-Fi，这种情况无需多说，「为所欲为」这个词可以说明一切，一切数据都可以被拦截。另外一种就是和你一样只是连接到同一个 Wi-Fi &#x2F;局域网的设备，也可以发动中间人攻击。</li>
<li>流氓软件。流氓软件和木马病毒一样，处于打击竞争对手和强行推广等目的，流氓软件直接在客户端篡改我们下载的文件。不同于木马病毒偷偷摸摸坏事的是，流氓软件需要用一个正当的理由掩饰这种行为。比如 3Q 大战的时候各家浏览器屏蔽或者篡改其他家软件的下载链接，浏览器就是下载器与服务器之间的那个「中间人」。</li>
<li>硬件。像是攻击者贴在 ATM 密码输入器上的复制硬件和插在网关上的数据监控器都是「中间人」。</li>
<li>监守自盗。平时我们使用某搜索引擎出来的网站经常先会瞬间跳转到一个地址再跳到我们想要访问的地址，然后你就会发现这个地址多了一些好像和网站本身风格好像不搭的广告（手机上更严重）；又或者你上着一个与运营商毫不相关的网站却弹出流量红包和流量球之类的推广，这个时候其实是某搜索引擎和这些运营商作为客户端和服务器的「中间人」劫持了你的请求。虽然不常见，不过这个时候它们是有能力篡改你的下载文件的，「监守自盗」这种中间人攻击最为防不胜防。</li>
</ol>
<p>FTP 与 HTTP 采用了相同的底层协议，同时 FTP 也是明文传输协议，所以 FTP 的安全性问题可以参考 HTTP。</p>
<p>还有一种在各种公共场合很常见的攻击：Wi-Fi 解除认证攻击。原理十分粗暴了，攻击者只需一个带有 Wi-Fi 的便宜开发板即可。<br>我们平时连接或者断开 Wi-Fi 的时候设备都会发送一个数据包来告诉路由器我要连接&#x2F;断开了，攻击者就是利用这一点。当攻击者启动开发板上的攻击程序之后，攻击程序会持续向路由器和连接设备发送断开连接的请求，让设备无法连接到指定的 Wi-Fi，整个过程就是这么简单。<br>听起来好像危害不大，实际上攻击者可以：</p>
<ul>
<li>在设备重新向路由器发送连接请求的时候拦截数据包，通过暴力破解（也就是根据装满密码的密码词典一个个尝试常见密码，更暴力的是把所有可能的密码都试一遍）的方式破解 Wi-Fi 密码。</li>
<li>让周围的无线设备例如监控摄像头，物联网设备失效。</li>
<li>在酒店会议等场合让所有 Wi-Fi 都无法被设备连接，只留下攻击者自己开的钓鱼热点。</li>
<li>获得 Wi-Fi 密码后，攻击者自己建立一个和原 Wi-Fi 相同 SSID（Wi-Fi 名字）和相同密码的钓鱼热点，然后攻击者迫使设备从原 Wi-Fi 断开后自动连接到钓鱼 Wi-Fi，接下来就是为所欲为的时间。</li>
</ul>
<h3 id="谁在监控——全世界都有能力看见你"><a href="#谁在监控——全世界都有能力看见你" class="headerlink" title="谁在监控——全世界都有能力看见你"></a>谁在监控——全世界都有能力看见你</h3><p>就在前面我们就说了「监守自盗」的问题，所有能篡改文件的方式都能用来监视。由于 HTTP 明文传输的特性，监控起来可以说是十分轻松。<br>在国家层面，中国有公共信息网络安全监察「网监」，美国有 FBI 与 NSA；其他国家除了相关部门，还有各种专门与各个运营商与公司合作的律师事务所。这些部门可以在法律与政府的支持下合法地持续监控所有 HTTP 上传下载流量。</p>
<p>简单说一下 FBI 与 NSA 对于互联网信息的分工，NSA 是负责信息收集这个方面的，像是前几年斯诺登曝光公众信息泄露和猖獗一时的 WannaCry 勒索病毒都和 NSA 脱不了干系。由于间谍与犯罪信息在没有确认之前界限非常模糊，所以 NSA 可以说「什么都管」。不过普通的互联网犯罪（例如违规 BT 下载）大部分时间还是 FBI 负责的。</p>
<p>国内相关法律与规定：《互联网信息服务管理办法》第十四条。<br>从事新闻、出版以及电子公告等服务项目的互联网信息服务提供者，应当记录提供的信息内容及其发布时间、互联网地址或者域名；<br>互联网接入服务提供者应当记录上网用户的上网时间、用户账号、互联网地址或者域名、主叫电话号码等信息。<br>互联网信息服务提供者和互联网接入服务提供者的记录备份应当保存 60 日，并在国家有关机关依法查询时，予以提供。<br>美国法律相关规定：<br>Federal law provides severe civil and criminal penalties for the unauthorized reproduction,distribution ,or exhibition of copyrighted motion pictures (title 17,united states code,sections 501 and 508),the federal bureau of investigation investigates allegations of criminal copyright infringement (title 17,united states code,section 506)<br>根据联邦法律规定，凡对未经授权，而对受版权保护的电影作品进行复制、发行或公开展出者，可导致严厉的民事或刑事处分（美国联邦法典第 17 篇，第 501 条与 508 条）。美国联邦调查局负责调查侵犯版权的投诉 （美国联邦法典第 17 篇，第 506 条）。<br>上面就是大名鼎鼎的 FBI Warning，相信各位对它比对国内的法律更加熟悉吧。<br>在中国运营商层面，为了配合国家政策，所有网站主在使用网络运营商提供的网络服务或者主机运营商提供的云主机服务时都必须同意将数据公开透明地提供给网络监控部门。并且网站自己的存储设备上必须保存至少 2 个月的所有数据。这个执行力度非常足，像是直播网站甚至所有直播用户的录屏都必须保存 2 个月，下载记录啥的更不用说了。<br>在公共设施方面，例如：大学，公司，车站等。一般都可以看做一个大局域网，只需要在局域网出口处放置一个监控软件，局域网内所有的数据都跑不掉。特别是大学与公司这种需要进行人员网络行为管理的地方，一般来讲都会配置「深信服、网路岗、WoekWin」等相关的网络行为管理软件。<br>公共设施监控这方面，国外与国内差不多，甚至国外要更为严重。具体到各个国家太复杂，这里就不细讲。<br>监控本身不是坏事，因为我们每时每刻都处于被监控的情景之下，监控可以更好地保证国家主权和个人的生命财产安全。侵犯隐私与否要看数据是否用于特例分析，如果这些最后会被匿名化用作大数据分析，对于个人来讲这些数据将毫无意义。<br>中国政府对于 BT Tracker 一直是处于严厉打击的状态，不断地关停 Tracker。不过只需要通过 BitCometTracker 等软件就能轻松搭建一个 Tracker，所以 Tracker 屡禁不止。<br>而且 BT 下载的时候同伴的 IP 是清晰可见的，想要监控十分容易。搭建一个钓鱼 Tracker 即可，就连我们自己也可以「追踪」一个下载者。运营商层面更简单，直接过滤出请求 Tracker 地址的请求就知道你在下载什么文件了。更别说自带文件评论和组队加速之类直接看到其他人账号的迅雷了。<br><a target="_blank" rel="noopener" href="https://iknowwhatyoudownload.com/en/peer/">https://iknowwhatyoudownload.com/en/peer/</a><br>一款bt网络监控工具，输入ip即可查看用户bt下载分发记录，并通过下载分发内容分析出用户喜好。还可分析出特定资源传播记录。这些数据对红队社工工作很有意义。 关于 bt 监控，国内之前也有专门做 bt 下载监控的公司，如埃文科技。bt 监控在打击犯罪方面具有很高的价值，但同时也存在隐私泄露问题。</p>
<h3 id="追踪BT"><a href="#追踪BT" class="headerlink" title="追踪BT"></a>追踪BT</h3><p>首先，可以通过种子搜索网站，获取海量的热门种子信息；其次，将种子上传至P2P网络实时监测平台，监控种子的访问记录；最后，将监控的种子访问记录信息清洗、分类、存储。<br>在网络安全应用中，IP种子的技术是要我们通过对BT种子进行分类，覆盖全球P2P网络，然后实时监控上百万级别的种子信息，含种子名称、类型、访问者IP和访问时长等信息。<br> 在网络安全领域，通过IP种子的技术，可以达到这样的一种案例场景。某市安全部门，通过对若干带有敏感信息的种子，进行了多天的监控，最终锁定传播人的IP地址和地理位置，并责令运营商对其网络监管加大力度。<br>按照协议，当客户端从 tracker 获取到新的 peer 节点时，就可以向该 peer 节点建立连接，并进行下载了。但是，在进行下载之前，客户端为了实现对资源的分片请求，需要知道远程的 peer 节点拥有该资源的哪些片段(piece)。这个步骤是通过 peer 节点之间的 handshake 与 bitField 命令实现的。客户端首先与 peer 节点建立连接，并发送 handshake 数据包。数据包的格式如下。</p>
<p>向 peer 节点发送 handshake 包后，客户端也会收到 peer 节点的 handshake 数据包。此外，随后还会收到一个 bitField 数据包，数据包的格式如下。</p>
<p>返回的 bitField 数据包的内容字段中，包含了一个 bitarray 的结构，标记了该 peer 节点对资源的每个片段(piece)的拥有情况。如果全部都为1，则代表该Peer已经完成了资源的下载。<br>借助以上思路，就可以对 bt 进行跟踪分析。</p>
<h3 id="eD2K-与-BT-下载正版资源时保护自己的权利"><a href="#eD2K-与-BT-下载正版资源时保护自己的权利" class="headerlink" title="eD2K 与 BT 下载正版资源时保护自己的权利"></a>eD2K 与 BT 下载正版资源时保护自己的权利</h3><p>最安全的就是使用 BT 做它该做的事情，例如下载开源系统或者非版权资源。下面的建议更偏向于在国外下载正版资源时保证安全。国内个人下载只要不触及几条底线，不担心监控问题基本没有法律问题。<br>不要在公共网络使用，在私人网络下载<br>无论是在国内外，学校与公司这种地方最好不要使用 BT 下载。特别是在国外，像是日本或者美国，这些国家对学校公司的对外流量控制特别严格，加上 BT「边上传边下载」的特性很容易给自己惹上警察。相比而言私人住宅就安全许多，毕竟国外私人领域的权限很高，很多美国人本身也在家用这些方式下载。<br>不要大流量<br>大部分运营商其实不会浪费资源去一个个去检测用户下载了什么，只有当某个用户的 BT 下载&#x2F;上传流量异常才会检查你是否下了不能下的文件然后警告+断网，如果多次被运营商警告你的个人信息是有可能被提交到版权方手里面的。<br>尽量限制上传流量<br>相比下载流量，运营商对 BT 上传流量检测更为严格，而且一旦你在下载的时候有上传的行为即是触犯了法律。可能会面临罚款等惩罚（被版权公司委托的律师事务所会根据运营商提供的信息对所有触犯法律的用户发起共同诉讼。）<br>不过限制上传流量之后下载速度会变慢，因为 BT 协议会根据上传速度来分配下载速度。还有一个很难注意的点是许多视频网站（特别是国外朋友用代理上中国视频网站的时候）的客户端都会默认开启 P2P 来缓解服务器压力，请使用这些客户端之前注意相关的事项。<br>此外还有使用代理或者虚拟专用网络下载，和避免在头 60 天下载资源，尽量下载非本国资源两种方法。<br>磁力链接安全，监控和法律问题<br>我们平时使用迅雷下载磁力链接，有时候会发现最后还是会下载一个种子文件。理论上磁力链接不需要 Tracker 也可以实现下载任意文件，但是国内很多网站只是为了规避法律风险直接把种子文件转换成磁力链接，实际上我们是先通过 P2P 下载种子再通过种子下载文件。<br>这种情况下的确可以保证种子的存活率，不过剩下就相当于传统的 BT 下载了。只有真正的通过 DHT 网络获取数据的下载才可以避免监控问题。<br>在盗版时，警方利用搜查证提取了最多人下载的几个 Tracker 上的记录，过滤出了前几个提供数据的 IP，又通过运营商查询 IP 访问记录确定了最早提供数据的 IP。这样警方就可以直接去抓人了。<br>但有些聪明的盗版者就不一样，他非常地聪明，做种的时候生成的是磁力链接。有了磁力链接（如 magnet:?xt&#x3D;urn:sha1:XXXXXXXXXXXXXXXXXXXXXXXX）之后：</p>
<ol>
<li>先找到一个到处求资源的用户 A，利用 Telegram 等私密通信的方式把磁力链接发给他。</li>
<li>用户 A 在下载客户端打开磁力链接，迅雷查询自己 DHT.dat 文件中的客户端向他们询问有没有文件指纹为 XXXXXXXXXXXXXXXXXXXXXXXX 的文件呀，结果当然是没有，接着这些客户端也会查询自己 DHT.dat 文件中的客户端并向他们请求这个文件，直到发现盗版者做种的客户端为止。（实际时间几秒钟左右）</li>
<li>用户 A 的迅雷接收到信息之后就开始连接盗版者的客户端进行下载，这时候盗版者如法炮制地把链接发给用户B， C，D，E…</li>
<li>在有一定基数的用户下载完后盗版者关闭客户端轻松隐身，再接下来的用户的客户端通过 DHT 搜索到的就是其他用户了，这里即是传统的 BT 下载。<br>通过磁力链接盗版者暴露了什么呢？一个文件指纹 XXXXXXXXXXXXXXXXXXXXXXXX，向最初的几个用户暴露了自己的地址，就这么多信息。因为没有中心服务器，不像传统的做种者一样会被 Tracker 记录上传信息，所有的通讯联系都是通过客户端间进行的，由于没办法对全中国支持磁力链接的下载客户端筛选连接记录，警方想要通过追查上传源来找到盗版者几乎不可能。<br>而除了盗版者以外所有的下载用户都可以随意分享磁力链接，因为不是上传者，传播的也只是一串字符而已，资源就这样被传播开来了。除了从搜索引擎或者约谈站长和谐磁力链接，正版方面对磁力链接也只能干瞪眼。</li>
</ol>
<h2 id="如何在国内提升下载速度"><a href="#如何在国内提升下载速度" class="headerlink" title="如何在国内提升下载速度"></a>如何在国内提升下载速度</h2><h3 id="提升-HTTP-x2F-FTP-下载速度"><a href="#提升-HTTP-x2F-FTP-下载速度" class="headerlink" title="提升 HTTP&#x2F;FTP 下载速度"></a>提升 HTTP&#x2F;FTP 下载速度</h3><p>看过前面 HTTP 原理的各位应该都知道 HTTP 和 FTP 是目前的下载方式中最为简单直接的了。这两种方法在下载时的速度完全由源地址的服务器分配，加速的方法十分有限。最有效和常见的加速方式就是多线程下载。</p>
<h4 id="使用多线程的技巧"><a href="#使用多线程的技巧" class="headerlink" title="使用多线程的技巧"></a>使用多线程的技巧</h4><p>多线程下载时最重要的是线程数的选择，并不是越多的线程数就越好。而合适的线程数取决于你的储存设备类型（数据读取速度）。</p>
<p>推荐一些多线程下载工具<br>Windows 上很多人都会推荐 IDM，当如果你不想花钱，那么免费的 FDM 是个更好的选择，界面简洁功能够用（还支持 BT 下载）。在 Mac 上 FDM 同样轻巧好用。</p>
<p>Android 上强力推荐 ADM。</p>
<h4 id="使用迅雷下载"><a href="#使用迅雷下载" class="headerlink" title="使用迅雷下载"></a>使用迅雷下载</h4><p>除了服务器限制，有时候使用 HTTP 下载达不到满速是因为服务器本身就是条「小水管」，实在满足不了我们的宽带速度。这个时候再想要加速就只能利用 P2SP 工具 —— 比如迅雷了，就如 P2SP 的原理一样，如果你下载的文件不是某个网站独占或者比较新的话，多个下载源的速度总会比一个下载源快。</p>
<h3 id="提升网盘下载速度"><a href="#提升网盘下载速度" class="headerlink" title="提升网盘下载速度"></a>提升网盘下载速度</h3><p>网盘也是我们日常下载中一个重要的数据来源，不过国内大家熟知的网盘在最近几年已经「挂」得七七八八了，需要提升速度的情况一般就是针对某个大家都知道的限速的网盘。下文的方法全部是针对这个网盘进行测试，总有一个可以提升下载速度。</p>
<h4 id="普通方法"><a href="#普通方法" class="headerlink" title="普通方法"></a>普通方法</h4><p>先说说如果放在自己网盘里面的文件下载限速了怎么办。第一个最简单的技巧是把自己想要下载的文件建立一个分享链接，退出账号后再通过分享链接下载。这招往往有奇效，因为宽带一般都是动态 IP，所以某网盘通常根据账号限速，没有登录账号下载一段时间之内不会被限速（同一个 IP 下载太多文件会被限速，这时候只要拔掉路由器电源等待 5 分钟再接上让运营商重新分配 IP 即可）。<br>缺点：麻烦，还不如买会员。</p>
<h4 id="高级方法"><a href="#高级方法" class="headerlink" title="高级方法"></a>高级方法</h4><p>当你使劲浑身系数精疲力竭都无法从「限速」这个恶魔手中逃出来，那么可以考虑这个高级方法了。<br>你可以将下不动的文件使用 multcloud 这个网站将文件同步到其他不限速的网盘后再下载，既然离开了某网盘，那么自然就没有「限速」这回事儿了。<br>multcloud 是一个在线网盘管理服务，支持包括添加某网盘，私人 FTP 与 NAS 在内的数十个网盘，并在它们之间通过服务器随意同步自己文件空间里面的文件。<br>不过这个网站在不同地区不同网盘间的同步速度非常玄学，建议不是那么急着下载或者实在是不想使用某网盘下载时再使用这项服务。并且请在同步私人文件前了解网站和相关网盘的用户条款。<br>缺点：支持的国内的云盘不够多。</p>
<h3 id="提升-BT-下载速度"><a href="#提升-BT-下载速度" class="headerlink" title="提升 BT 下载速度"></a>提升 BT 下载速度</h3><p>除了迅雷这种把下载过的资源缓存到自己服务器上来实现“加速”的 BT软件，其他的 BT 软件都是单纯靠其他用户给你提供下载速度。<br>如果你想找到速度比迅雷还快的 BT 软件，很难！</p>
<ul>
<li>BT 下载的文件都是其他用户上传给你的。</li>
<li>BT 下载速度都来自其他用户的上传速度。</li>
</ul>
<p>如果你想任何资源都高速稳定下载，那就别用 BT 了，改用百度网盘+超级会员吧。<br>既然知道了用户越多，下载速度越快，那么用户从哪里来？<br>想要加速 BT 下载，同样是根据它的下载原理 —— 越多人同时下载越快得出加速方法：让自己找到更多同时在线的用户。而想要找到更多的用户，</p>
<p>目前 BT 获取用户的方法有三种，分别是 Peer、DHT、Tracker。<br>从 Tracker 和 DHT 网络两个方面入手：</p>
<ul>
<li>不要限制 BT 上传速度</li>
<li>更新 Tracker</li>
<li>开启 UPnP（以 DHT 为基础）</li>
</ul>
<h3 id="不要限制上传速度"><a href="#不要限制上传速度" class="headerlink" title="不要限制上传速度"></a>不要限制上传速度</h3><p>BT 下载本身就是根据上传速度决定你的下载速度，给别人的数据越多，别人给你的数据也就越多，所以平时下载的时候不要看到上传速度太高就去限制上传速度。唯一推荐限制上传速度的情况是：文件已经下好且没有正在下载的文件，为其他下载者提供数据时。</p>
<h3 id="更新-Tracker"><a href="#更新-Tracker" class="headerlink" title="更新 Tracker"></a>更新 Tracker</h3><p>Tracker 是下载种子时重要的一部分，不同类型的文件通常有着不同的 Tracker。而且由于 Tracker 天生的中心化，分享文件的 Tracker 会频繁地更换地址，每天也会不停地有 Tracker 被关闭（封）和建立。简单来讲就是你在用 BT 下载客户端在文件的时候，客户端定时以 HTTP 协议给 Tracker 发送这些消息：我是谁（ID）？我在哪（IP 地址和端口）？我要下什么？</p>
<p>如果同时下载多个文件，就会发送多条请求（即使下载完成，只要不停止上传也会继续发送请求）。Tracker 收到后就会记录下来，然后再从服务器上找到正在下载同一个文件的记录，把下载者信息发回给你的 BT 下载客户端，然后你的 Bt 客户端就和其他下载者的客户端商量着交换数据。</p>
<p>一般 Tracker 都是内置于客户端或者种子里面，不会自动更新，这种情况下经常更新 Tracker 可以让我们时刻保持和 BT 网络里面的绝大部分用户保持连接，轻松解决「死种」和做种者过少的问题。</p>
<p>想要时刻知道最新的 Tracker 列表，有许多网站可以选择。trackerslist 这个项目就是其中更新地比较及时分类比较完善的，每次更新都会整理出懒人专用的最佳 Tracker 列表，只需要把以下的链接加到书签：<br><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/ngosang/trackerslist/master/trackers_best.txt">https://raw.githubusercontent.com/ngosang/trackerslist/master/trackers_best.txt</a><br><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/ngosang/trackerslist/master/trackers_best.txt">https://raw.githubusercontent.com/ngosang/trackerslist/master/trackers_best_ip.txt</a></p>
<p>下面说说得到 Tracker 地址以后如何使用。修改 Tracker 有两种方法，不同工具修改种子有两种，磁力本身就支持在链接后面添加 Tracker。</p>
<ol>
<li>迅雷<br>第一种方法是通过Torrent File Editor 这种工具编辑种子，把 Tracker 手动添加进去再下载新的种子。用这种方法添加 Tracker 有点麻烦。<br>第二种方法是把上面两个 txt 里面的列表保存到一个文本文档里面，每次迅雷弹出新建任务提示的时候在右边的属性设置粘贴 Tracker 列表，这个方法支持迅雷 9 之前的版本，新版迅雷已经不支持添加自定义的 Tracker 这个功能，如果坚持用迅雷下载，再麻烦也只能用第一个方法了。</li>
<li>Aria2 与其他 BT 下载客户端<br>Aria2 想要用上最新的 Tracker 不用每次下载都添加列表，也不用修改种子文件，步骤比较简单。在 aria2.conf 文件末尾加上如下选项：bt-tracker&#x3D;，后面跟上没有空格，以英文逗号分隔的 Tracker 列表就行。以后进行下载 Aria2 都会调用这份列表了。<br>当然你想要每次下载时添加 Tracker 也是没问题的，新建任务时在（支持的控制台）高级设置中找到 bt-tracker 这个选项填入以英文逗号分隔的 Tracker 列表即可。<br>至于其他 BT 下载客户端（例如 qBittorrent）本身就提供完善的自定义 Tracker 功能，直接在设置里面添加想要的 Traccker 列表。<br>除了种子，磁力链接也是我们经常接触到的下载方式，每次发现磁力链接下载不动的时候都可以手动加上一些 Tracker 地址，往往会有奇效。</li>
<li>磁力链接<br>磁力链接本身就支持在链接后面直接添加 Tracker<br>magnet:?xt&#x3D;urn:btih:xx&amp;tr&#x3D;<a target="_blank" rel="noopener" href="http://189.23.18.16:8000/Fannounce&amp;tr=udp://14.38.18.18:8000/announce">http://189.23.18.16:8000/Fannounce&amp;tr=udp://14.38.18.18:8000/announce</a></li>
</ol>
<p>直接在 HASH 值后面添加 Tracker 即可，每一条 Tracker 地址都要写成 &amp;tr&#x3D;Tracker 地址 的形式。</p>
<h3 id="UPnP（通用即插即用协议）"><a href="#UPnP（通用即插即用协议）" class="headerlink" title="UPnP（通用即插即用协议）"></a>UPnP（通用即插即用协议）</h3><p>UPnP是一个以 UDP 为基础的协议，它原本是一个端口映射的功能，也就是将内网的一个端口暴露到公网。在 BT 下载中的作用是让下载器能够接受更多外网用户的主动连接，以找到更多同一文件正在下载的人和做种者。</p>
<p>这个功能需要在支持 UPnP 功能的路由器上开启相关选项之后才能生效（在路由器后台开启带 UPnP 字样的选项，现在的路由器一般是默认开启的），在使用时需要注意一点：UPnP 运行时对路由器内存和处理器配置要求比较高，如果在低配的路由器上长时间开启容易导致路由器系统崩溃。<br>另外，还要保证我们电脑的防火墙没有禁止 UPnP 相关端口的网络连接权限。而且有时候电脑优化软件会关掉 UPnP 相关的服务导致功能异常，在设置好路由器后还应该检查下我们的电脑。<br>路由器启用 UPnP 后，如果电脑中的软件也支持 UPnP 协议（比如迅雷），路由器会在软件打开后根据软件的需求打开相应的端口，实测开启 UPnP 功能后 BT 下载速度有了很大的提升。</p>
<ol>
<li><p>迅雷<br>迅雷在之前提供了是否使用 UPnP 的设置，在最新版本的迅雷里面却不见了。考虑到现在的路由器大多都默认开启 UPnP，个人猜测应该是作为默认开启且不可关闭的选项。</p>
</li>
<li><p>Aria2 及其他 BT 下载客户端<br>Aria2 并不支持内网 UPnP，所以你必须有一个公网 IP；其他 BT 下载客户端的相关选项一般位于设置 —— 连接里面，类似「使用我的路由器的 UPnP &#x2F; NAT-PMP 端口转发」的名称。<br>至于公网 IP 这个概念并没有十分严格的解释，通俗地解释就是运营商给用户分配的 IP 地址一般就是一个巨大局域网内的地址（例如所有使用电信宽带的用户就组成了电信用户局域网），这个 IP 地址一般是动态的，所以你无法访问这个 IP 地址（内网 IP）。而网站服务器需要让所有用户都能访问到它，就必须有一个固定的全球互联网都可以访问的 IP 地址，这就是公网 IP。<br>普通用户想要申请公网 IP 也不难，一种方法是和你的宽带运营商客服说「想要远程访问家里的监控摄像头」，是否有用请以实际情况为准。</p>
</li>
</ol>
<h4 id="手动设置-DHT-dat-文件"><a href="#手动设置-DHT-dat-文件" class="headerlink" title="手动设置 DHT.dat 文件"></a>手动设置 DHT.dat 文件</h4><p>使用 Aria2 时还可以通过自定义的程序目录下的 DHT.dat 文件来加速下载，每一次下载的时候 DHT.dat 负责记录下这次下载中和你交换数据附近的节点，以便下次下载时省去发现节点的时间。DHT.dat 文件可以解决有时候种子和磁力链接甚至都不能开始下载的问题。<br>有个更新dat文件的方法很简单，准备一个你所知道的最热门的种子，然后让 Aria2 完整的下一遍就行，下完你再看 DHT.dat 就会发现大小改变了，这时候 Aria2 就已经把刚才搜到的节点全部写入里面了。</p>
<h3 id="我目前的-BT-下载方式"><a href="#我目前的-BT-下载方式" class="headerlink" title="我目前的 BT 下载方式"></a>我目前的 BT 下载方式</h3><p>电脑上主要使用 BitComet&#x2F;qBittorrentEE，主要这两个支持订阅 Tracker URL 自动更新。<br>因为现在用电脑的机会比较少，会准备了一台内置储存大的 Android 手机来下载之后再转到其他设备（比如电脑），平时很少用电脑去下载。这是因为：</p>
<ol>
<li>手机上 UFS2.1 储存的读写速度（几百 M 每秒）完全没有任何瓶颈，可以随心所欲地不用限速。</li>
<li>比起电脑，手机上对于代理流量管理更加清晰和方便，轻松确定下载软件的流量是否有走梯子，不会出现电脑上挂着梯子有时却不走梯子的尴尬。</li>
<li>手机上长时间下载更加节省能源，Aria2 搭在手机端。</li>
<li>不知道为什么，同一个资源在手机上的 App 比用电脑客户端下载快。<br>下载好的文件可以在局域网下同步到电脑或者主力手机专门的文件夹里面。千兆路由器局域网同步文件的速度最高有百兆每秒，完全不用担心大文件同步的速度问题。<br>总的来讲这台手机担当的工作有点像是下载器版的 NAS，不过比 NAS 便宜多了。<br>现如今，很多国家地区的网络审查制度对种子下载和分享服务的使用审查严重，甚至部分（如亚洲某些区域，俄罗斯，美国和澳大利亚）对种子站点已发出禁令关闭，以保护支持产权拥有者的权益。无论你是身处在这些种子被禁国家，想绕过区域限制访问并下载种子文件，还是仅仅在进行种子搜索、下载和分享的时候拥有更好的隐私性，你都可以借助于第三方 VPN 工具实现匿名，保障安全。<br>监控和安全问题国内的朋友大可不必担心，我国的版权制度较为宽松。国外的朋友可以搜一下「罗马尼亚」或「DMCA Free」或「VPS」这些关键词。<br>找一个版权宽松地区的VPS（罗马尼亚、荷兰）搭建一个代理，然后用于BT下载应该可行，使用欧美那边的VPS下载日本动漫问题就不是很大，不过如果下载美剧就会很快被发现然后机器被关掉。<br><a target="_blank" rel="noopener" href="https://bgm.tv/group/topic/342969">https://bgm.tv/group/topic/342969</a><br>应用方面，普通下载我自己用的肯定就是推荐过很多次的 ADM Pro 了，没别的选择。BT 下载的我是用的是 Flud 这款 App，拥有包括自定义 Tracker 和 UPnP 在内全部电脑端 BT 下载客户端的功能。<br>有时候不想下载视频文件我就使用种子磁力播放器 com.iiplayer.sunplayer 去在线观看，这个播放器很干净，就简简单单复制链接播放的功能，没有广告资源推荐搜索之类的垃圾。</li>
</ol>
<h2 id="资源站点推荐"><a href="#资源站点推荐" class="headerlink" title="资源站点推荐"></a>资源站点推荐</h2><p><a target="_blank" rel="noopener" href="https://rutracker.org/forum/index.php">https://rutracker.org/forum/index.php</a><br><a target="_blank" rel="noopener" href="https://z-lib.org/">https://z-lib.org</a><br><a target="_blank" rel="noopener" href="https://rarbgprx.org/">https://rarbgprx.org/</a><br><a target="_blank" rel="noopener" href="http://thepiratebay.org/">http://thepiratebay.org/</a><br><a target="_blank" rel="noopener" href="https://rarbg.to/index80.php">https://rarbg.to/index80.php</a></p>

  </div>
  <div class="post-footer">
    

    <a href="#top" class="top">↑</a>
  </div>
</article>
<footer>
  &copy; 2022
  <span class="author">
    betta
  </span>
</footer>

    </div>
  </body>
</html>
